<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Logs da Simulação</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f9; color: #333; }
        .container { max-width: 1400px; margin: auto; background: #fff; padding: 20px; box-shadow: 0 0 15px rgba(0,0,0,0.1); border-radius: 8px; }
        
        /* NOVO ESTILO: Título e Data na mesma linha */
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #6c757d;
            padding-bottom: 10px;
            margin-bottom: 20px; /* Espaço após a linha */
        }
        .header-container h1 {
            color: #444;
            margin: 0;
            font-size: 2em;
        }
        .header-container .generated-time {
            font-size: 0.9em;
            color: #6c757d;
            margin: 0;
            white-space: nowrap; /* Evita quebra de linha */
        }
        
        /* Estilos dos Cards (Filtros) */
        .filter-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin-bottom: 30px; 
            text-align: center;
        }
        .card { 
            padding: 15px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
        .card.active {
            box-shadow: 0 0 0 3px #333, 0 2px 5px rgba(0,0,0,0.3);
        }
        .card h3 { 
            margin: 0; 
            font-size: 1.1em;
            text-transform: uppercase;
        }
        .card p { 
            font-size: 2.5em; 
            margin: 0; 
            font-weight: bold; 
        }

        /* Cores dos BOTÕES */
        .level-critical { background-color: #000000; color: #fff; }
        .level-error { background-color: #dc3545; color: #fff; }
        .level-warning { background-color: #ffc107; color: #333; }
        .level-info { background-color: #007bff; color: #fff; }
        .level-debug { background-color: #6c757d; color: #fff; }
        
        /* Estilos para a tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        thead th { 
            position: sticky; 
            top: 0; 
            background-color: #495057; 
            color: white;
            padding: 12px;
            text-align: left;
            z-index: 10;
        }
        td { 
            padding: 12px; 
            border: 1px solid #dee2e6; 
            text-align: left; 
            background-color: transparent !important; 
            color: #333;
        }
        
        /* Fundo Branco e Cinza Claro para as linhas */
        tbody tr:nth-child(even) { 
            background-color: #f8f9fa;
        }
        tbody tr:nth-child(odd) {
            background-color: #fff;
        }
        
        /* Estilos de cor para as células do nível (Apenas Cor do Texto) */
        .log-level-cell.critical { color: #721c24; font-weight: bold; }
        .log-level-cell.error { color: #721c24; font-weight: bold; }
        .log-level-cell.warning { color: #856404; font-weight: bold; }
        .log-level-cell.info { color: #0c5460; }
        .log-level-cell.debug { color: #383d41; }
        
        .log-table-container { 
            max-height: 800px; 
            overflow-y: auto; 
            margin-top: 20px;
        }
        .footer { text-align: center; margin-top: 20px; font-size: 0.9em; color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="header-container">
            <h1>Dashboard de Logs da Simulação</h1>
            <p class="generated-time">Gerado em: {{ generation_time }}</p>
        </div>
        
        <h2>Contagens por Nível de Log</h2>
        <div class="filter-grid" id="filter-grid">
            <div 
                class="card active" 
                onclick="filterLogs('all', this)" 
                style="background-color: #495057; color: #fff;"
            >
                <h3>TOTAL</h3>
                <p>{{ summary.total_logs | default(0) }}</p>
            </div>
            
            {% for data in summary.all_level_counts %}
            <div 
                class="card" 
                data-level="{{ data.level | lower }}"
                onclick="filterLogs('{{ data.level | lower }}', this)" 
                style="background-color: {{ data.color }}; color: {% if data.level in ['CRITICAL', 'INFO', 'DEBUG'] %}#fff{% else %}#333{% endif %};"
            >
                <h3>{{ data.level }}</h3>
                <p>{{ data.count }}</p>
            </div>
            {% endfor %}
        </div>

        <h2 id="log-list-title">Lista Completa de Logs ({{ summary.total_logs | default(0) }} registos)</h2>
        <div class="log-table-container">
            <table>
                <thead>
                    <tr><th>Timestamp</th><th>Nível</th><th>Módulo</th><th>Mensagem</th></tr>
                </thead>
                <tbody id="log-table-body">
                    {% for log in simulation_logs %}
                    <tr class="log-row level-{{ log.level_class }}">
                        <td>{{ log.timestamp }}</td>
                        <td class="log-level-cell {{ log.level_class }}">{{ log.level }}</td>
                        <td>{{ log.module }}</td>
                        <td>{{ log.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <p class="footer">Projeto de Simulação de Tráfego com SUMO</p>
    </div>

    <script>
        const allLogs = document.querySelectorAll('.log-row');
        const logListTitle = document.getElementById('log-list-title');
        const filterCards = document.querySelectorAll('.card');

        /**
         * Filtra os logs exibidos na tabela com base no nível clicado.
         * @param {string} level O nível de log a filtrar ('all', 'info', 'error', etc.).
         * @param {HTMLElement} clickedCard O elemento card clicado.
         */
        function filterLogs(level, clickedCard) {
            let count = 0;
            const filterClass = `level-${level}`;

            // Remove o estado 'active' de todos os cards
            filterCards.forEach(card => card.classList.remove('active'));
            // Adiciona o estado 'active' ao card clicado
            if (clickedCard) {
                clickedCard.classList.add('active');
            }

            allLogs.forEach(row => {
                if (level === 'all') {
                    row.style.display = '';
                    count++;
                } else if (row.classList.contains(filterClass)) {
                    row.style.display = '';
                    count++;
                } else {
                    row.style.display = 'none';
                }
            });

            // Atualiza o título da lista de logs
            if (level === 'all') {
                logListTitle.textContent = `Lista Completa de Logs (${count} registos)`;
            } else {
                // A capitalização correta do nível (ex: critical -> CRITICAL)
                const displayLevel = level.charAt(0).toUpperCase() + level.slice(1).toLowerCase();
                logListTitle.textContent = `Logs Filtrados - Nível ${displayLevel} (${count} registos)`;
            }
        }

        // Garante que o filtro inicial seja 'all' e que o botão TOTAL esteja ativo
        window.onload = () => filterLogs('all', document.getElementById('filter-grid').firstElementChild);
    </script>
</body>
</html> 