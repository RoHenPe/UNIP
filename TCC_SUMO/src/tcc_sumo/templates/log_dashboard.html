<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Análise de Logs - Simulação SUMO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-2.0.8/b-3.0.2/b-html5-3.0.2/b-print-3.0.2/datatables.min.css"/>
    <style>
        :root{--primary:#2c3e50;--secondary:#3498db;--success:#27ae60;--danger:#e74c3c;--warning:#f39c12;--info:#3498db;--light-bg:#f8f9fa;}
        body{background-color:#f0f3f5;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;color:#495057;}
        .header{background:linear-gradient(135deg,var(--primary) 0%,#1a2530 100%);color:white;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
        .card{transition:transform 0.3s,box-shadow 0.3s;border:none;border-radius:10px;overflow:hidden;box-shadow:0 4px 8px rgba(0,0,0,0.05);background-color:#fff;}
        .card-header-stats{background-color: var(--primary); color: white; border-bottom: none;}
        /* Estilos de cor para o corpo do log */
        .log-error{color: var(--danger); font-weight: bold;}
        .log-warning{color: var(--warning); font-weight: bold;}
        .log-info{color: var(--info);}
        .log-unknown{color: #7f8c8d;}
        /* Estilos de cor para os badges de nível */
        .level-badge-ERROR { background-color: var(--danger); }
        .level-badge-WARNING { background-color: var(--warning); color: #2c3e50 !important; }
        .level-badge-INFO { background-color: var(--info); }
        .level-badge-UNKNOWN { background-color: #7f8c8d; }
    </style>
</head>
<body>
    <header class="header py-4 mb-4">
        <div class="container">
            <h1 class="display-4"><i class="fas fa-terminal me-2"></i> Dashboard de Análise de Logs SUMO</h1>
            <p class="lead">Análise detalhada de erros, avisos e informações da simulação.</p>
        </div>
    </header>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center bg-danger text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-exclamation-triangle"></i> ERROS</h5>
                        <p class="card-text fs-2">{{ stats.ERROR | default(0) }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-warning text-dark">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-bell"></i> AVISOS</h5>
                        <p class="card-text fs-2">{{ stats.WARNING | default(0) }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-info text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-info-circle"></i> INFORMAÇÕES</h5>
                        <p class="card-text fs-2">{{ stats.INFO | default(0) }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-hashtag"></i> TOTAL DE LOGS</h5>
                        <p class="card-text fs-2">{{ total_logs }}</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card shadow-sm">
            <div class="card-header card-header-stats">
                <h4 class="mb-0"><i class="fas fa-list-alt me-2"></i> Logs Detalhados</h4>
            </div>
            <div class="card-body p-4">
                <p class="text-muted">Última Geração: {{ timestamp_geracao }}</p>
                <div class="table-responsive">
                    <table id="logTable" class="table table-striped table-hover w-100">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Nível</th>
                                <th>Arquivo Fonte</th>
                                <th>Mensagem</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in logs %}
                            <tr>
                                <td>{{ log.timestamp }}</td>
                                <td>
                                    <span class="badge level-badge-{{ log.level }}">{{ log.level }}</span>
                                </td>
                                <td>{{ log.source_file }}</td>
                                <td class="log-{{ log.level | lower }}">{{ log.message }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0" style="font-size: 0.9rem;">Dashboard gerado automaticamente pelo **Log Analyzer** do projeto TCC_SUMO.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-2.0.8/b-3.0.2/b-html5-3.0.2/b-print-3.0.2/datatables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script>
        $(document).ready(function() {
            $('#logTable').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/2.0.8/i18n/pt-BR.json"
                },
                "dom": 'lBfrtip', // Habilita botões ('B')
                "buttons": [
                    { extend: 'copy', text: '<i class="fas fa-copy me-1"></i> Copiar' },
                    { extend: 'csv', text: '<i class="fas fa-file-csv me-1"></i> CSV' },
                    { extend: 'excel', text: '<i class="fas fa-file-excel me-1"></i> Excel' },
                    { extend: 'print', text: '<i class="fas fa-print me-1"></i> Imprimir' }
                ],
                "order": [[ 0, "desc" ]] // Ordena pelo timestamp mais recente
            });
        });
    </script>
</body>
</html>